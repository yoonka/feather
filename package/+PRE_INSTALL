#!/bin/sh
# Runs before files are extracted

set -e

# Create group if missing
if ! pw groupshow feather >/dev/null 2>&1; then
  pw groupadd feather
fi

# Create user if missing
if ! pw usershow feather >/dev/null 2>&1; then
  pw useradd feather -g feather -d /var/db/feather -s /usr/sbin/nologin -c "Feather mail user"
  install -d -o feather -g feather -m 0755 /var/db/feather
fi

# Create config/log/run directories early so later chowns don't fail
install -d -o root   -g wheel   -m 0755 /usr/local/etc/feather
install -d -o feather -g feather -m 0755 /var/log/feather
install -d -o feather -g feather -m 0755 /var/run/feather

exit 0
